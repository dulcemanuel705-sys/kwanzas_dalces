<!DOCTYPE html>
<html lang="pt">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<title>Fornecedores - Kwanzas Metal</title>
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/logo.png">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="assets/css/feathericon.min.css">
	<link rel="stylesheet" href="https://cdn.oesmith.co.uk/morris-0.5.1.css">
	<link rel="stylesheet" href="assets/plugins/morris/morris.css">
	<link rel="stylesheet" href="assets/css/style.css">
	<style>
		/* ===== MODERN PROFESSIONAL DASHBOARD STYLES ===== */
	   
	   /* Root Variables for Consistent Theming */
	   :root {
	     --primary-color: #2c3e50;
	     --primary-dark: #1a252f;
	     --primary-light: #34495e;
	     --accent-color: #0fd7d4;
	     --accent-dark: #0ab5b3;
	     --secondary-color: #95a5a6;
	     --dark-bg: #000000;
	     --darker-bg: #000000;
	     --light-bg: #f8f9fa;
	     --card-bg: #ffffff;
	     --text-primary: #2c3e50;
	     --text-secondary: #7f8c8d;
	     --border-color: #dee2e6;
	     --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
	     --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
	     --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
	     --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
	     --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
	     --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	   }

	   /* Global Styles */
	   body {
	     background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
	     color: var(--text-primary);
	     font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
	     font-size: 14px;
	     line-height: 1.6;
	   }

	   /* Header Enhancements */
	   .header {
	     background: var(--card-bg);
	     box-shadow: 0 2px 8px rgba(0,0,0,0.04);
	     border-bottom: 1px solid var(--border-color);
	   }

	   .header-left {
	     background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%) !important;
	   }

	   /* Sidebar Professional Styling - Black with Cyan */
	   .sidebar {
	     background: #000000 !important;
	     box-shadow: 2px 0 10px rgba(0,0,0,0.3);
	   }

	   .sidebar .sidebar-menu ul li a {
	     color: #ffffff !important;
	     opacity: 0.85;
	     transition: var(--transition-fast);
	     padding: 10px 16px;
	     border-radius: 8px;
	     margin: 2px 8px;
	   }

	   .sidebar .sidebar-menu ul li a:hover {
	     color: #ffffff !important;
	     opacity: 1;
	     background: rgba(15, 215, 212, 0.1);
	     transform: translateX(5px);
	   }

	   .sidebar .sidebar-menu ul li.active > a {
	     color: #ffffff !important;
	     font-weight: 600;
	     background: rgba(15, 215, 212, 0.2);
	     border-left: 3px solid #0fd7d4;
	   }

	   .sidebar .submenu_class li a {
	     color: #f2f9ff !important;
	     opacity: 0.8;
	     font-size: 13px;
	   }

	   .sidebar .submenu_class li a:hover {
	     color: #0fd7d4 !important;
	     opacity: 1;
	   }

	   /* Sidebar submenu layout mais corporativo */
	   .sidebar .sidebar-menu > ul > li > a {
	     display: flex;
	     align-items: center;
	     justify-content: flex-start;
	     gap: 8px;
	     font-size: 14px;
	     font-weight: 500;
	   }

	   .sidebar .sidebar-menu > ul > li > a i {
	     margin-right: 6px;
	     font-size: 15px;
	     color: #ffffff !important;
	   }

	   .sidebar .sidebar-menu .menu-arrow {
	     margin-left: auto;
	     transition: transform 0.2s ease;
	   }

	   .sidebar .submenu.active > a .menu-arrow {
	     transform: rotate(90deg);
	   }

	   /* Page Header */
	   .page-header h1 {
	     color: var(--text-primary);
	     font-weight: 700;
	     font-size: 28px;
	     letter-spacing: -0.5px;
	     margin-bottom: 0;
	   }

	   .page-header h1 span {
	     background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
	     -webkit-background-clip: text;
	     -webkit-text-fill-color: transparent;
	     background-clip: text;
	   }

	   /* Main Metrics Card */
	   .board1 {
	     border-radius: 10px;
	     border: none !important;
	     background: #000000;
	     box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	     overflow: hidden;
	     transition: var(--transition-smooth);
	     height: 150px;
	     min-width: 194px;
	     margin: 0 5px 15px;
	     position: relative;
	     flex: 0 0 auto;
	   }

	   .board1::before {
	     content: '';
	     position: absolute;
	     top: 0;
	     left: 0;
	     right: 0;
	     bottom: 0;
	     background: linear-gradient(135deg, rgba(10, 181, 179, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%);
	     opacity: 0;
	     transition: var(--transition-smooth);
	     z-index: 0;
	   }

	   .board1:hover {
	     box-shadow: 0 8px 25px rgba(10, 181, 179, 0.4);
	     transform: translateY(-5px);
	   }

	   .board1:hover::before {
	     opacity: 1;
	   }

	   .board1 .card-body {
	     padding: 12px 10px !important;
	     position: relative;
	     z-index: 1;
	     height: 100%;
	     display: flex;
	     flex-direction: column;
	     justify-content: center;
	   }

	   /* Metric Cards Inside Board */
	   .board1 .card-body {
	     background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%) !important;
	     border-radius: 12px;
	     transition: var(--transition-smooth);
	     position: relative;
	     overflow: hidden;
	     border: 1px solid rgba(10, 181, 179, 0.2);
	   }

	   .board1 .card-body::before {
	     content: '';
	     position: absolute;
	     top: 0;
	     left: -100%;
	     width: 100%;
	     height: 100%;
	     background: linear-gradient(90deg, transparent, rgba(10, 181, 179, 0.3), transparent);
	     transition: var(--transition-smooth);
	   }

	   .board1:hover .card-body::before {
	     left: 100%;
	     transition: left 0.6s ease;
	   }

	   .board1:hover .card-body {
	     background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;
	     border-color: #0ab5b3;
	     box-shadow: inset 0 0 20px rgba(10, 181, 179, 0.2);
	   }

	   @keyframes shimmer {
	     0% { transform: translate(-50%, -50%) rotate(0deg); }
	     100% { transform: translate(-50%, -50%) rotate(360deg); }}

	   .board1 h3 {
	     color: #0ab5b3 !important;
	     font-weight: 700;
	     margin-bottom: 3px;
	     font-size: 1.2rem;
	     line-height: 1.2;
	     white-space: nowrap;
	     overflow: hidden;
	     text-overflow: ellipsis;
	     text-shadow: 0 0 20px rgba(10, 181, 179, 0.5);
	     position: relative;
	     z-index: 1;
	     transition: var(--transition-smooth);
	   }

	   .board1:hover h3 {
	     color: #fff !important;
	     text-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
	   }

	   .board1 h6 {
	     color: rgba(10, 181, 179, 0.9) !important;
	     font-weight: 500;
	     letter-spacing: 0.8px;
	     text-transform: uppercase;
	     white-space: nowrap;
	     overflow: hidden;
	     text-overflow: ellipsis;
	     margin: 0;
	     position: relative;
	     z-index: 1;
	     font-size: 0.7rem;
	     transition: var(--transition-smooth);
	   }

	   .board1:hover h6 {
	     color: rgba(255, 255, 255, 0.95) !important;
	     letter-spacing: 1px;
	   }

	   .board1 i {
	     position: relative;
	     z-index: 1;
	     color: #0ab5b3 !important;
	     filter: drop-shadow(0 0 10px rgba(10, 181, 179, 0.5));
	     transition: var(--transition-smooth);
	   }

	   .board1:hover i {
	     color: #fff !important;
	     filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.7));
	     transform: scale(1.1);
	   }

	   /* Quick Links Section */
	   .quick-link-card {
	     text-decoration: none;
	     display: block;
	     transition: var(--transition-smooth);
	   }

	   .quick-link-card:hover {
	     text-decoration: none;
	   }

	   .quick-link-card > div {
	     background: #f8f9fa;
	     border: 1px solid var(--border-color);
	     border-radius: 8px;
	     padding: 12px 10px !important;
	     transition: var(--transition-smooth);
	     position: relative;
	     overflow: hidden;
	   }

	   .quick-link-card > div::after {
	     content: '';
	     position: absolute;
	     bottom: 0;
	     left: 0;
	     width: 100%;
	     height: 2px;
	     background: #0fd7d4;
	     transform: scaleX(0);
	     transition: var(--transition-smooth);
	   }

	   .quick-link-card:hover > div {
	     background: #0fd7d4;
	     border-color: #0fd7d4;
	     transform: translateY(-3px);
	     box-shadow: 0 6px 15px rgba(15, 215, 212, 0.25);
	   }

	   .quick-link-card:hover > div::after {
	     transform: scaleX(1);
	   }

	   .quick-link-card i {
	     font-size: 1.5rem;
	     color: #2c3e50;
	     transition: var(--transition-smooth);
	   }

	   .quick-link-card:hover i {
	     color: #fff !important;
	     transform: scale(1.05);
	   }

	   .quick-link-card h6 {
	     color: var(--text-primary);
	     margin: 0;
	     font-size: 0.9rem;
	     font-weight: 600;
	     transition: var(--transition-smooth);
	   }

	   .quick-link-card:hover h6 {
	     color: #fff !important;
	   }

	   /* Card Enhancements */
	   .card {
	     border: none;
	     border-radius: 12px;
	     box-shadow: var(--shadow-md);
	     transition: var(--transition-smooth);
	     background: var(--card-bg);
	   }

	   .card:hover {
	     box-shadow: var(--shadow-lg);
	   }

	   .card-header {
	     background: #2c3e50;
	     border: none;
	     border-radius: 10px 10px 0 0 !important;
	     padding: 12px 20px;
	   }

	   .card-header h4 {
	     color: #fff !important;
	     margin: 0;
	     font-weight: 600;
	     font-size: 0.95rem;
	     letter-spacing: 0.3px;
	   }

	   .card-body {
	     padding: 24px;
	   }

	   /* Chart Cards with Black Background */
	   .card-chart {
	     background: #ffffff !important;
	     border: 1px solid rgba(10, 181, 179, 0.3);
	     box-shadow: 0 4px 15px rgba(0,0,0,0.15);
	   }

	   .card-chart .card-body {
	     background: #ffffff !important;
	     padding: 20px;
	   }

	   /* Altura mínima para os gráficos, garantindo que as barras/linhas sejam visíveis */
	   #line-chart,
	   #bar-chart {
	     min-height: 260px;
	   }

	   .card-chart svg text {
	     fill: #0ab5b3 !important;
	   }

	   .card-chart svg .morris-hover {
	     background: rgba(10, 181, 179, 0.9) !important;
	     color: #fff !important;
	   }

	   /* Table Styling */
	   .card-table {
	     background: #ffffff !important;
	     border: 1px solid rgba(10, 181, 179, 0.3);
	     box-shadow: 0 4px 15px rgba(0,0,0,0.15);
	   }

	   .card-table .card-header {
	     background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;
	     border-bottom: 2px solid #0ab5b3;
	   }

	   .card-table .card-header h4 {
	     color: #fff !important;
	   }

	   .card-table .card-body {
	     background: #ffffff !important;
	     padding: 20px;
	   }

	   .table {
	     margin-bottom: 0;
	     background: #ffffff !important;
	   }

	   .table thead th {
	     background: #1a1a1a !important;
	     color: #0ab5b3 !important;
	     font-weight: 600;
	     font-size: 0.85rem;
	     text-transform: uppercase;
	     letter-spacing: 0.5px;
	     border: 1px solid rgba(10, 181, 179, 0.2) !important;
	     padding: 14px 12px;
	   }

	   .table tbody tr {
	     transition: var(--transition-fast);
	     background: #ffffff !important;
	     border-bottom: 1px solid rgba(10, 181, 179, 0.15);
	   }

	   .table tbody tr:hover {
	     background: rgba(10, 181, 179, 0.05) !important;
	     transform: scale(1.005);
	     box-shadow: 0 2px 8px rgba(10, 181, 179, 0.15);
	   }

	   .table tbody td {
	     padding: 12px;
	     vertical-align: middle;
	     border-color: rgba(10, 181, 179, 0.15) !important;
	     color: #2c3e50 !important;
	   }

	   /* Button Enhancements */
	   .btn-primary {
	     background: #0fd7d4;
	     border: none;
	     border-radius: 8px;
	     padding: 10px 24px;
	     font-weight: 600;
	     letter-spacing: 0.3px;
	     transition: var(--transition-smooth);
	     box-shadow: 0 4px 12px rgba(15, 215, 212, 0.25);
	     color: #000;
	   }

	   .btn-primary:hover {
	     transform: translateY(-2px);
	     box-shadow: 0 6px 16px rgba(15, 215, 212, 0.35);
	     background: #0ab5b3;
	     color: #fff;
	   }

	   .veiwbutton {
	     font-size: 0.875rem;
	     padding: 8px 20px;
	   }

	   /* Chart Cards */
	   .card-chart {
	     border-radius: 12px;
	     overflow: hidden;
	   }

	   .card-chart .card-title {
	     color: #fff;
	     font-weight: 600;
	     font-size: 1rem;
	     text-transform: uppercase;
	     letter-spacing: 1px;
	   }

	   /* Animations */
	   @keyframes fadeInUp {
	     from {
	       opacity: 0;
	       transform: translateY(30px);
	     }
	     to {
	       opacity: 1;
	       transform: translateY(0);
	     }
	   }

	   @keyframes fadeIn {
	     from {
	       opacity: 0;
	     }
	     to {
	       opacity: 1;
	     }
	   }

	   @keyframes slideInRight {
	     from {
	       opacity: 0;
	       transform: translateX(30px);
	     }
	     to {
	       opacity: 1;
	       transform: translateX(0);
	     }
	   }

	   .card.board1 {
	     animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
	   }

	   .quick-link-card {
	     animation: fadeIn 0.5s ease-out;
	   }

	   .quick-link-card:nth-child(1) { animation-delay: 0.1s; }
	   .quick-link-card:nth-child(2) { animation-delay: 0.2s; }
	   .quick-link-card:nth-child(3) { animation-delay: 0.3s; }
	   .quick-link-card:nth-child(4) { animation-delay: 0.4s; }
	   .quick-link-card:nth-child(5) { animation-delay: 0.5s; }

	   .card-chart {
	     animation: slideInRight 0.6s ease-out;
	   }

	   /* Responsive Adjustments */
	   @media (max-width: 768px) {
	     .page-header h1 {
	       font-size: 22px;
	     }

	     .board1 h3 {
	       font-size: 1.5rem;
	     }

	     .quick-link-card i {
	       font-size: 2rem;
	     }
	   }

	   /* Loading State */
	   .loading {
	     opacity: 0.6;
	     pointer-events: none;
	   }

	   /* Scrollbar Styling */
	   ::-webkit-scrollbar {
	     width: 8px;
	     height: 8px;
	   }

	   ::-webkit-scrollbar-track {
	     background: var(--light-bg);
	   }

	   ::-webkit-scrollbar-thumb {
	     background: var(--text-secondary);
	     border-radius: 4px;
	   }

	   ::-webkit-scrollbar-thumb:hover {
	     background: var(--primary-color);
	   }
	 </style>
<body>
	<div class="main-wrapper">
		<div class="header">
			<div class="header-left">
				<a href="dashboard.html" class="logo"> <img src="assets/img/kwanzaWhite.svg" width="50" height="70" alt="logo"> <span class="logoclass"></span> </a>
				<a href="dashboard.html" class="logo logo-small"> <img src="assets/img/kwanzaWhite.svg" alt="Logo" width="30" height="30"> </a>
			</div>
			<a href="javascript:void(0);" id="toggle_btn"> <i class="fe fe-text-align-left"></i> </a>
			<a class="mobile_btn" id="mobile_btn"> <i class="fas fa-bars"></i> </a>
			<ul class="nav user-menu">
				<li class="nav-item dropdown has-arrow">
					<a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown"> <span class="user-img"><img class="rounded-circle" src="assets/img/profiles/avatar-01.jpg" width="31" alt=""></span> </a>
					<div class="dropdown-menu">
						<div class="user-header">
							<div class="avatar avatar-sm"> <img src="foto do perfil" alt="User Image" class="avatar-img rounded-circle"> </div>
							<div class="user-text">
								<div class="muted" style="font-size:11px">Bem-vindo(a), </div>
								<h6><span id="userName">usuário</span></h6>
							</div>
						</div> <a class="dropdown-item" href="profile.html">Perfil</a> <a class="dropdown-item" href="settings.html">configurações da conta</a> <a class="dropdown-item" id="logoutBtn" href="#">Sair</a> </div>
				</li>
			</ul>
			<div class="top-nav-search">
				<form>
					<input type="text" class="form-control" placeholder="procurar">
					<button class="btn" type="submit"><i class="fas fa-search"></i></button>
				</form>
			</div>
		</div>
		<div class="sidebar" id="sidebar">
			<div class="sidebar-inner slimscroll">
				<div id="sidebar-menu" class="sidebar-menu">
					<ul>
						<li class="active"> <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a> </li>
						<li> <a href="clientes_clientes.html"><i class="fas fa-user"></i> <span>Clientes</span></a></li>
						<li class="submenu"> <a href="#" data-toggle="collapse"><i class="fas fa-user"></i> <span> Empresa </span> <span class="menu-arrow"></span></a>
							<ul class="submenu_class" style="display: none;">
								<li><a href="rh_funcionarios.html">Funcionários</a></li>
								<li><a href="rh_departamentos.html">Departamentos & Cargos</a></li>
								<li><a href="rh_ferias.html">Férias</a></li>
								<li><a href="users.html">Utilizadores</a></li>
							</ul>
						</li>
						
						<li class="active"> <a href="fornecedor.html"><i class="fas fa-user"></i> <span> Fornecedores</span></a> </li>
						<li> <a href="financas.html#bancos"><i class="fas fa-university"></i> <span> Bancos</span></a> </li>
						<li> <a href="financas.html#pagamentos"><i class="fas fa-money-bill-alt"></i> <span> Pagamentos</span></a> </li>
						<li> <a href="faturas.html"><i class="fas fa-file-invoice"></i> <span>Faturas</span></a> </li>
						<li> <a href="projectos.html"><i class="fas fa-cube"></i> <span>Projectos Kwanza </span></a> </li>
					</ul>
				</div>
			</div>
		</div>
		<div class="page-wrapper">
      <div class="content container-fluid">
        <div class="page-header">
          <div class="row">
            <div class="col-sm-12 mt-5">
              <h1>Fornecedores</h1>
              <p class="text-muted mb-0">Todos os fornecedores</p>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <a class="btn btn-primary" href="fornecedores.html">Adicionar Fornecedor</a>
            <button id="btnDeleteAllFornecedores_cli" class="btn btn-outline-danger ml-2">Eliminar Todos</button>
            <a class="btn btn-outline-primary ml-2" href="clientes_clientes.html" title="Abrir outra página de clientes">Clientes</a>
          </div>
          <div class="col-auto">
            <input id="searchInput" class="form-control form-control-sm" placeholder="Pesquisar..." />
          </div>
        </div>

        <div class="row">
          <div class="col-12 d-flex">
            <div class="card card-table flex-fill">
              <div class="card-header d-flex align-items-center justify-content-between">
                <h4 class="card-title mb-0">Todos os fornecedores <span id="totalFornecedores" class="badge badge-info ml-2">0</span></h4>
              </div>
              <div class="card-body">
                <div class="table-responsive sticky-th">
                  <table id="tblClientes" class="table table-hover table-center table-sm">
                    <thead>
                      <tr>
                        <th style="width:100px">Nº Ordem</th>
                        <th>Nome/Firma</th>
                        <th>NIF</th>
                        <th>Situação</th>
                        <th style="width:120px">Ações</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="assets/js/jquery-3.5.1.min.js"></script>
  <script src="assets/js/popper.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script src="assets/plugins/raphael/raphael.min.js"></script>
  <script src="assets/plugins/morris/morris.min.js"></script>
  <script src="assets/js/chart.morris.js"></script>
  <script src="assets/js/script.js"></script>
  <!-- Carrega o avatar do usuário -->
  <script src="js/profile-avatar.js"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
  <style>
    .alerts-container{ position: fixed; top: 70px; right: 16px; z-index: 1080; width: 320px; }
  </style>
  <div class="alerts-container" id="alertsContainer"></div>
  <script>
    async function checkAuth() {
      const token = localStorage.getItem('token');
      if (!token) { window.location.href = '/'; return; }
      try {
        const res = await fetch('/api/users/me', { headers: { Authorization: `Bearer ${token}` } });
        if (res.status === 401 || res.status === 403) {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/';
          return;
        }
        if (!res.ok) throw new Error('server_error');
        const me = await res.json();
        const userName = document.getElementById('userName');
        if (userName) userName.textContent = me?.nome || 'usuário';
      } catch {}
    }
    checkAuth();

    function showAlert(message, variant = 'success', timeout = 3000){
      const container = document.getElementById('alertsContainer');
      if(!container) return window.alert(message);
      const id = 'al_'+Date.now()+Math.random().toString(16).slice(2);
      const el = document.createElement('div');
      el.id = id;
      el.className = `alert alert-${variant} alert-dismissible fade show mb-2`;
      el.role = 'alert';
      el.innerHTML = `
        <div>${message}</div>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>`;
      container.appendChild(el);
      if(timeout){ setTimeout(() => { try{ $(el).alert('close'); }catch{} el.remove(); }, timeout); }
    }

    let dados = [];

    function renderTabela(items){
      const tbody = document.querySelector('#tblClientes tbody');
      tbody.innerHTML = items.map(it => `
        <tr>
          <td>${it.num_ordem || ''}</td>
          <td>${it.nome || ''}</td>
          <td>${it.nif || ''}</td>
          <td>${it.situacao || ''}</td>
          <td>
            <button class='btn btn-sm btn-outline-primary' data-id='${it.id || ''}' onclick='editarFornecedor("${it.id || ''}")'>Editar</button>
            <button class='btn btn-sm btn-outline-danger ml-1' data-id='${it.id || ''}' onclick='removerFornecedor("${it.id || ''}")'>Eliminar</button>
          </td>
        </tr>
      `).join('');
    }

    function editarFornecedor(id){
      if(!id) return;
      window.location.href = `fornecedores.html?id=${encodeURIComponent(id)}`;
    }

    async function removerFornecedor(id){
      if(!id) return;
      try{
        const conf = await Swal.fire({
          title: 'Eliminar fornecedor?',
          text: 'Esta ação não pode ser desfeita.',
          icon: 'warning', showCancelButton: true,
          confirmButtonText: 'Sim, eliminar',
          cancelButtonText: 'Cancelar'
        });
        if(!conf.isConfirmed) return;
        const token = localStorage.getItem('token');
        try{
          const res = await fetch(`/api/fornecedores/${encodeURIComponent(id)}` , {
            method: 'DELETE',
            headers: token ? { Authorization: `Bearer ${token}` } : {},
          });
          if(res.ok || res.status === 204){
            dados = dados.filter(x => String(x.id ?? '') !== String(id ?? ''));
            renderTabela(dados);
            const totalEl = document.getElementById('totalFornecedores');
            if(totalEl) totalEl.textContent = String(Math.max(0, parseInt(totalEl.textContent || '0', 10) - 1));
            await Swal.fire('Eliminado!', 'Fornecedor eliminado com sucesso.', 'success');
            // Recarrega a página para garantir atualização total do estado
            window.location.reload();
          } else {
            console.error('Falha ao eliminar cliente');
            await Swal.fire('Erro', 'Falha ao eliminar fornecedor.', 'error');
          }
        }catch(err){ console.error('Erro ao eliminar cliente', err); await Swal.fire('Erro', 'Falha ao eliminar.', 'error'); }
      }catch(e){ /* ignore */ }
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      const filtrado = dados.filter(it => (
        String(it.num_ordem||'').toLowerCase().includes(q) ||
        (it.nome||'').toLowerCase().includes(q) ||
        (it.nif||'').toLowerCase().includes(q) ||
        (it.situacao||'').toLowerCase().includes(q)
      ));
      renderTabela(filtrado);
    });

    async function carregarClientes(){
      const token = localStorage.getItem('token');
      try{
        const res = await fetch('/api/fornecedores', {
          headers: token ? { Authorization: `Bearer ${token}` } : {}
        });
        if(!res.ok){ throw new Error('erro_listar_fornecedores'); }
        const data = await res.json();
        const items = Array.isArray(data) ? data : (data.items || []);
        dados = items.map(it => ({
          id: it.id,
          num_ordem: it.num_ordem,
          nome: it.nome || it.nome_firma || '',
          nif: it.nif || '',
          situacao: it.situacao || '',
        }));
        renderTabela(dados);
        const total = Array.isArray(data) ? items.length : (typeof data.total === 'number' ? data.total : items.length);
        const totalEl = document.getElementById('totalFornecedores');
        if(totalEl) totalEl.textContent = String(total);
      }catch(err){
        console.error('Erro ao carregar fornecedores', err);
        renderTabela([]);
        const totalEl = document.getElementById('totalFornecedores');
        if(totalEl) totalEl.textContent = '0';
      }
    }

    // Eliminar Todos (para fornecedores listados nesta página)
    (function bindDeleteAllClientesAsForn(){
      const btn = document.getElementById('btnDeleteAllFornecedores_cli');
      if(!btn) return;
      btn.addEventListener('click', async () => {
        try{
          const conf = await Swal.fire({
            title: 'Eliminar todos os fornecedores?',
            text: 'Esta ação não pode ser desfeita.',
            icon: 'warning', showCancelButton: true,
            confirmButtonText: 'Sim, eliminar todos',
            cancelButtonText: 'Cancelar'
          });
          if(!conf.isConfirmed) return;
          btn.disabled = true; btn.textContent = 'A eliminar...';
          const ids = (Array.isArray(dados) ? dados : []).map(it => it.id).filter(Boolean);
          if(ids.length === 0){ await Swal.fire('Nada a eliminar', 'Não há fornecedores na lista.', 'info'); btn.disabled=false; btn.textContent='Eliminar Todos'; return; }
          const token = localStorage.getItem('token');
          const delOne = (id) => fetch(`/api/fornecedores/${encodeURIComponent(id)}`, { method:'DELETE', headers: token ? { Authorization: `Bearer ${token}` } : {} });
          const results = await Promise.allSettled(ids.map(delOne));
          const ok = results.filter(r => r.status==='fulfilled' && r.value && (r.value.ok || r.value.status===204)).length;
          const fail = ids.length - ok;
          await Swal.fire('Concluído', `Eliminados: ${ok}\nFalharam: ${fail}`, fail ? 'warning' : 'success');
          await carregarClientes();
        }catch(err){ console.error('Eliminar todos (clientes.html) falhou:', err); alert('Falha ao eliminar.'); }
        finally{ btn.disabled=false; btn.textContent='Eliminar Todos'; }
      });
    })();

    // Inicializar
    carregarClientes();
  </script>
</body>
</html>
