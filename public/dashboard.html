<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<title>Kwanzas Metal</title>
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/logo.png">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="assets/css/feathericon.min.css">
	<link rel="stylesheet" href="https://cdn.oesmith.co.uk/morris-0.5.1.css">
	<link rel="stylesheet" href="assets/plugins/morris/morris.css">
	<link rel="stylesheet" href="assets/css/style.css">
	<script>
	  // Evita flash de elementos proibidos ao contabilista: esconde o HTML logo no início
	  (function(){
	    try{
	      var uStr = localStorage.getItem('user');
	      if (!uStr) return;
	      var u = null;
	      try { u = JSON.parse(uStr); } catch(e){}
	      if (u && u.tipo === 'contabilista') {
	        document.documentElement.style.visibility = 'hidden';
	      }
	    }catch(e){}
	  })();
	</script>
	</head>
 <style>
    /* ===== MODERN PROFESSIONAL DASHBOARD STYLES ===== */
    
    /* Root Variables for Consistent Theming */
    :root {
      --primary-color: #2c3e50;
      --primary-dark: #1a252f;
      --primary-light: #34495e;
      --accent-color: #0fd7d4;
      --accent-dark: #0ab5b3;
      --secondary-color: #95a5a6;
      --dark-bg: #000000;
      --darker-bg: #000000;
      --light-bg: #f8f9fa;
      --card-bg: #ffffff;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --border-color: #dee2e6;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
      --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
      --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Global Styles */
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.6;
    }

    /* Header Enhancements */
    .header {
      background: var(--card-bg);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border-bottom: 1px solid var(--border-color);
    }

    .header-left {
      background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%) !important;
    }

    /* Sidebar Professional Styling - Black with Cyan */
    .sidebar {
      background: #000000 !important;
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
    }

    .sidebar .sidebar-menu ul li a {
      color: #ffffff !important;
      opacity: 0.85;
      transition: var(--transition-fast);
      padding: 10px 16px;
      border-radius: 8px;
      margin: 2px 8px;
    }

    .sidebar .sidebar-menu ul li a:hover {
      color: #ffffff !important;
      opacity: 1;
      background: rgba(15, 215, 212, 0.1);
      transform: translateX(5px);
    }

    .sidebar .sidebar-menu ul li.active > a {
      color: #ffffff !important;
      font-weight: 600;
      background: rgba(15, 215, 212, 0.2);
      border-left: 3px solid #0fd7d4;
    }

    .sidebar .submenu_class li a {
      color: #f2f9ff !important;
      opacity: 0.8;
      font-size: 13px;
    }

    .sidebar .submenu_class li a:hover {
      color: #0fd7d4 !important;
      opacity: 1;
    }

    /* Sidebar submenu layout mais corporativo */
    .sidebar .sidebar-menu > ul > li > a {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .sidebar .sidebar-menu > ul > li > a i {
      margin-right: 6px;
      font-size: 15px;
      color: #ffffff !important;
    }

    .sidebar .sidebar-menu .menu-arrow {
      margin-left: auto;
      transition: transform 0.2s ease;
    }

    .sidebar .submenu.active > a .menu-arrow {
      transform: rotate(90deg);
    }

    /* Page Header */
    .page-header h1 {
      color: var(--text-primary);
      font-weight: 700;
      font-size: 28px;
      letter-spacing: -0.5px;
      margin-bottom: 0;
    }

    .page-header h1 span {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Main Metrics Card */
    .board1 {
      border-radius: 10px;
      border: none !important;
      background: #000000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: var(--transition-smooth);
      height: 150px;
      min-width: 194px;
      margin: 0 5px 15px;
      position: relative;
      flex: 0 0 auto;
    }

    .board1::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(10, 181, 179, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%);
      opacity: 0;
      transition: var(--transition-smooth);
      z-index: 0;
    }

    .board1:hover {
      box-shadow: 0 8px 25px rgba(10, 181, 179, 0.4);
      transform: translateY(-5px);
    }

    .board1:hover::before {
      opacity: 1;
    }

    .board1 .card-body {
      padding: 12px 10px !important;
      position: relative;
      z-index: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Metric Cards Inside Board */
    .board1 .card-body {
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%) !important;
      border-radius: 12px;
      transition: var(--transition-smooth);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(10, 181, 179, 0.2);
    }

    .board1 .card-body::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(10, 181, 179, 0.3), transparent);
      transition: var(--transition-smooth);
    }

    .board1:hover .card-body::before {
      left: 100%;
      transition: left 0.6s ease;
    }

    .board1:hover .card-body {
      background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;
      border-color: #0ab5b3;
      box-shadow: inset 0 0 20px rgba(10, 181, 179, 0.2);
    }

    @keyframes shimmer {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }}

    .board1 h3 {
      color: #0ab5b3 !important;
      font-weight: 700;
      margin-bottom: 3px;
      font-size: 1.2rem;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-shadow: 0 0 20px rgba(10, 181, 179, 0.5);
      position: relative;
      z-index: 1;
      transition: var(--transition-smooth);
    }

    .board1:hover h3 {
      color: #fff !important;
      text-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
    }

    .board1 h6 {
      color: rgba(10, 181, 179, 0.9) !important;
      font-weight: 500;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0;
      position: relative;
      z-index: 1;
      font-size: 0.7rem;
      transition: var(--transition-smooth);
    }

    .board1:hover h6 {
      color: rgba(255, 255, 255, 0.95) !important;
      letter-spacing: 1px;
    }

    .board1 i {
      position: relative;
      z-index: 1;
      color: #0ab5b3 !important;
      filter: drop-shadow(0 0 10px rgba(10, 181, 179, 0.5));
      transition: var(--transition-smooth);
    }

    .board1:hover i {
      color: #fff !important;
      filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.7));
      transform: scale(1.1);
    }

    /* Quick Links Section */
    .quick-link-card {
      text-decoration: none;
      display: block;
      transition: var(--transition-smooth);
    }

    .quick-link-card:hover {
      text-decoration: none;
    }

    .quick-link-card > div {
      background: #f8f9fa;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px 10px !important;
      transition: var(--transition-smooth);
      position: relative;
      overflow: hidden;
    }

    .quick-link-card > div::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: #0fd7d4;
      transform: scaleX(0);
      transition: var(--transition-smooth);
    }

    .quick-link-card:hover > div {
      background: #0fd7d4;
      border-color: #0fd7d4;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(15, 215, 212, 0.25);
    }

    .quick-link-card:hover > div::after {
      transform: scaleX(1);
    }

    .quick-link-card i {
      font-size: 1.5rem;
      color: #2c3e50;
      transition: var(--transition-smooth);
    }

    .quick-link-card:hover i {
      color: #fff !important;
      transform: scale(1.05);
    }

    .quick-link-card h6 {
      color: var(--text-primary);
      margin: 0;
      font-size: 0.9rem;
      font-weight: 600;
      transition: var(--transition-smooth);
    }

    .quick-link-card:hover h6 {
      color: #fff !important;
    }

    /* Card Enhancements */
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      transition: var(--transition-smooth);
      background: var(--card-bg);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      background: #2c3e50;
      border: none;
      border-radius: 10px 10px 0 0 !important;
      padding: 12px 20px;
    }

    .card-header h4 {
      color: #fff !important;
      margin: 0;
      font-weight: 600;
      font-size: 0.95rem;
      letter-spacing: 0.3px;
    }

    .card-body {
      padding: 24px;
    }

    /* Chart Cards with Black Background */
    .card-chart {
      background: #ffffff !important;
      border: 1px solid rgba(10, 181, 179, 0.3);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }

    .card-chart .card-body {
      background: #ffffff !important;
      padding: 20px;
    }

    /* Altura mínima para os gráficos, garantindo que as barras/linhas sejam visíveis */
    #line-chart,
    #bar-chart {
      min-height: 260px;
    }

    .card-chart svg text {
      fill: #0ab5b3 !important;
    }

    .card-chart svg .morris-hover {
      background: rgba(10, 181, 179, 0.9) !important;
      color: #fff !important;
    }

    /* Table Styling */
    .card-table {
      background: #ffffff !important;
      border: 1px solid rgba(10, 181, 179, 0.3);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }

    .card-table .card-header {
      background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;
      border-bottom: 2px solid #0ab5b3;
    }

    .card-table .card-header h4 {
      color: #fff !important;
    }

    .card-table .card-body {
      background: #ffffff !important;
      padding: 20px;
    }

    .table {
      margin-bottom: 0;
      background: #ffffff !important;
    }

    .table thead th {
      background: #1a1a1a !important;
      color: #0ab5b3 !important;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid rgba(10, 181, 179, 0.2) !important;
      padding: 14px 12px;
    }

    .table tbody tr {
      transition: var(--transition-fast);
      background: #ffffff !important;
      border-bottom: 1px solid rgba(10, 181, 179, 0.15);
    }

    .table tbody tr:hover {
      background: rgba(10, 181, 179, 0.05) !important;
      transform: scale(1.005);
      box-shadow: 0 2px 8px rgba(10, 181, 179, 0.15);
    }

    .table tbody td {
      padding: 12px;
      vertical-align: middle;
      border-color: rgba(10, 181, 179, 0.15) !important;
      color: #2c3e50 !important;
    }

    /* Button Enhancements */
    .btn-primary {
      background: #0fd7d4;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      font-weight: 600;
      letter-spacing: 0.3px;
      transition: var(--transition-smooth);
      box-shadow: 0 4px 12px rgba(15, 215, 212, 0.25);
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(15, 215, 212, 0.35);
      background: #0ab5b3;
      color: #fff;
    }

    .veiwbutton {
      font-size: 0.875rem;
      padding: 8px 20px;
    }

    /* Chart Cards */
    .card-chart {
      border-radius: 12px;
      overflow: hidden;
    }

    .card-chart .card-title {
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .card.board1 {
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .quick-link-card {
      animation: fadeIn 0.5s ease-out;
    }

    .quick-link-card:nth-child(1) { animation-delay: 0.1s; }
    .quick-link-card:nth-child(2) { animation-delay: 0.2s; }
    .quick-link-card:nth-child(3) { animation-delay: 0.3s; }
    .quick-link-card:nth-child(4) { animation-delay: 0.4s; }
    .quick-link-card:nth-child(5) { animation-delay: 0.5s; }

    .card-chart {
      animation: slideInRight 0.6s ease-out;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .page-header h1 {
        font-size: 22px;
      }

      .board1 h3 {
        font-size: 1.5rem;
      }

      .quick-link-card i {
        font-size: 2rem;
      }
    }

    /* Loading State */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--light-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--text-secondary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-color);
    }
 </style>
<body>
	<div class="main-wrapper">
		<div class="header">
			<div class="header-left">
				<a href="dashboard.html" class="logo"> <img src="assets/img/kwanzaWhite.svg" width="50" height="70" alt="logo"> <span class="logoclass"></span> </a>
				<a href="dashboard.html" class="logo logo-small"> <img src="assets/img/kwanzaWhite.svg" alt="Logo" width="30" height="30"> </a>
			</div>
			<a href="javascript:void(0);" id="toggle_btn"> <i class="fe fe-text-align-left"></i> </a>
			<a class="mobile_btn" id="mobile_btn"> <i class="fas fa-bars"></i> </a>
			<ul class="nav user-menu">
				<li class="nav-item dropdown has-arrow">
					<a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown"> <span class="user-img"><img class="rounded-circle" src="assets/img/profiles/avatar-01.jpg" width="31" alt=""></span> </a>
					<div class="dropdown-menu">
						<div class="user-header">
							<div class="avatar avatar-sm"> <img src="foto do perfil" alt="User Image" class="avatar-img rounded-circle"> </div>
							<div class="user-text">
								<div class="muted" style="font-size:11px">Bem-vindo(a), </div>
								<h6><span id="userName">usuário</span></h6>
							</div>
						</div> <a class="dropdown-item" href="profile.html">Perfil</a> <a class="dropdown-item" href="settings.html">configurações da conta</a> <a class="dropdown-item" id="logoutBtn" href="#">Sair</a> </div>
				</li>
			</ul>
			<div class="top-nav-search">
				<form>
					<input type="text" class="form-control" placeholder="procurar">
					<button class="btn" type="submit"><i class="fas fa-search"></i></button>
				</form>
			</div>
		</div>
		<div class="sidebar" id="sidebar">
			<div class="sidebar-inner slimscroll">
				<div id="sidebar-menu" class="sidebar-menu">
					<ul>
						<li class="active"> <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a> </li>
						<li> <a href="clientes_clientes.html"><i class="fas fa-user"></i> <span>Clientes</span></a> </li>
						<li class="submenu"> <a href="#" data-toggle="collapse"><i class="fas fa-user"></i> <span> Empresa </span> <span class="menu-arrow"></span></a>
							<ul class="submenu_class" style="display: none;">
								<li><a href="rh_funcionarios.html">Funcionários</a></li>
								<li><a href="rh_departamentos.html">Departamentos & Cargos</a></li>
								<li><a href="rh_ferias.html">Férias</a></li>
								<li><a href="users.html">Utilizadores</a></li>
							</ul>
						</li>
						
						<li class="submenu"> <a href="#" data-toggle="collapse"><i class="fas fa-user"></i> <span> Fornecedores</span> <span class="menu-arrow"></span></a>
							<ul class="submenu_class" style="display: none;">
								<li><a href="fornecedor.html">Lista de Fornecedores </a></li>
							</ul>
						</li>
						<li> <a href="financas.html#bancos"><i class="fas fa-university"></i> <span> Bancos</span></a> </li>
						<li> <a href="financas.html#pagamentos"><i class="fas fa-money-bill-alt"></i> <span> Pagamentos</span></a> </li>
            <li> <a href="faturas.html"><i class="fas fa-file-invoice"></i> <span>Faturas</span></a> </li>
						<li> <a href="projectos.html"><i class="fas fa-cube"></i> <span>Projectos Kwanza </span></a> </li>
					</ul>
				</div>
			</div>
		</div>
		<div class="page-wrapper">
			<div class="content container-fluid">
				<div class="page-header">
					<div class="row">
						<div class="col-sm-12 mt-5">
							<h1>Bem-vindo(a), <span id="userName">usuário</span></h1>
						</div>
					</div>
				</div>
				<!-- Cards de Métricas Principais -->
				<div class="row">
					<!-- Clientes -->
					<div class="d-inline-flex">
						<a href="clientes_clientes.html" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-user-friends" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="clientesCount" style="margin-bottom: 3px;">0</h3>
									<h6 style="margin: 0;">Clientes</h6>
								</div>
							</div>
						</a>
					</div>
					<!-- Fornecedores -->
					<div class="d-inline-flex">
						<a href="fornecedor.html" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-users" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="fornecedoresCount" style="margin-bottom: 3px;">0</h3>
									<h6 style="margin: 0;">Fornecedores</h6>
								</div>
							</div>
						</a>
					</div>
					<!-- Projectos -->
					<div class="d-inline-flex">
						<a href="projectos.html" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-project-diagram" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="projCount" style="margin-bottom: 3px;">0</h3>
									<h6 style="margin: 0;">Projectos</h6>
								</div>
							</div>
						</a>
					</div>
					<!-- Caixa -->
					<div class="d-inline-flex">
						<a href="financas.html#fundo" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-dollar-sign" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="caixaTotal" style="font-size: 1.2rem; margin-bottom: 3px;">Kz 0,00</h3>
									<h6 style="margin: 0;">Caixa</h6>
								</div>
							</div>
						</a>
					</div>
					<!-- Bancos -->
					<div class="d-inline-flex">
						<a href="financas.html#bancos" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-university" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="bancosCount" style="margin-bottom: 3px;">0</h3>
									<h6 style="margin: 0;">Bancos</h6>
								</div>
							</div>
						</a>
					</div>
					<!-- Dívida Fornecedores (contas a pagar) -->
					<div class="d-inline-flex">
						<a href="faturas.html" style="text-decoration:none;">
							<div class="card board1">
								<div class="card-body text-center p-3">
									<div class="mb-1">
										<i class="fas fa-file-invoice-dollar" style="font-size: 1.8rem; color: #fff;"></i>
									</div>
									<h3 id="dividaFornecedoresTotal" style="margin-bottom: 3px; font-size: 1.1rem;">Kz 0,00</h3>
									<h6 style="margin: 0;">Dívida Fornecedores</h6>
								</div>
							</div>
						</a>
					</div>
				</div>

				<!-- Links Rápidos -->
				<div class="row mt-2">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<h4 style="font-size: 1rem;"><i class="fas fa-link mr-2"></i>Acesso Rápido</h4>
							</div>
							<div class="card-body p-3">
								<div class="row">
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-2">
									<a href="clientes_clientes.html" class="quick-link-card">
										<div class="text-center p-2">
											<i class="fas fa-user-friends mb-1"></i>
											<h6 class="mb-0" style="font-size: 0.8rem;">Clientes</h6>
										</div>
									</a>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-2">
									<a href="fornecedor.html" class="quick-link-card">
										<div class="text-center p-2">
											<i class="fas fa-users mb-1"></i>
											<h6 class="mb-0" style="font-size: 0.8rem;">Fornecedores</h6>
										</div>
									</a>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-2">
									<a href="projectos.html" class="quick-link-card">
										<div class="text-center p-2">
											<i class="fas fa-project-diagram mb-1"></i>
											<h6 class="mb-0" style="font-size: 0.8rem;">Projectos</h6>
										</div>
									</a>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-2">
									<a href="financas.html" class="quick-link-card">
										<div class="text-center p-2">
											<i class="fas fa-money-bill-wave mb-1"></i>
											<h6 class="mb-0" style="font-size: 0.8rem;">Finanças</h6>
										</div>
									</a>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-2">
									<a href="financas.html#bancos" class="quick-link-card">
										<div class="text-center p-2">
											<i class="fas fa-university mb-1"></i>
											<h6 class="mb-0" style="font-size: 0.8rem;">Bancos</h6>
										</div>
									</a>
								</div>
																	</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 col-lg-6">
						<div class="card card-chart">
							<div class="card-header" style="background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;">
								<h4 class="card-title" style="color: #fff !important;">FINANCEIRO</h4> </div>
							<div class="card-body">
								<div id="line-chart"></div>
							</div>
						</div>
					</div>
					<div class="col-md-12 col-lg-6">
						<div class="card card-chart">
							<div class="card-header" style="background: linear-gradient(135deg, #0ab5b3 0%, #08a09e 100%) !important;">
								<h4 class="card-title" style="color: #fff !important;">Visão Geral Financeira</h4> </div>
							<div class="card-body">
								<div id="bar-chart"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 d-flex">
						<div class="card card-table flex-fill">
							<div class="card-header">
								<h4 class="card-title float-left mt-2">Mapa Fornecedores</h4>
								<button type="button" class="btn btn-primary float-right veiwbutton">Ver Todos</button>
							</div>
							<div class="card-body">
								<div class="table-responsive">
									<table class="table table-hover table-center" id="tblMapaFornecedores">
										<thead>
											<tr>
												<th>Nº Ordem</th>
												<th>NIF do Contribuinte</th>
												<th>Nome / Firma</th>
												<th>PAGO VIA</th>
												<th>Nº FACTURA</th>
												<th>CUSTO ACEITE OU NÃO</th>
												<th>Data do Documento</th>
												<th>MÊS</th>
												<th>Valor do Documento</th>
												<th>Valor Tributável p/ IVA</th>
												<th>Valor Tributável p/ Retenção</th>
												<th>IVA Dedutível</th>
												<th>IVA SUPORTADO</th>
												<th>IVA DEDUTIVEL</th>
												<th>VALOR PAGO</th>
												<th>DÍVIDA</th>
												<th>SITUAÇÃO</th>
												<th>RFONT</th>
												<th>TIPOLOGIA</th>
												<th>ID PROJECTO</th>
												<th>OBS</th>
												<th>DATA PAGAMENTO</th>
											</tr>
										</thead>
										<tbody id="tbodyMapaFornecedores">
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="assets/js/jquery-3.5.1.min.js"></script>
	<script src="assets/js/popper.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="assets/js/script.js"></script>
	<!-- Carrega o avatar do usuário -->
	<script src="js/profile-avatar.js"></script>
	<script src="assets/plugins/raphael/raphael.min.js"></script>
	<script src="assets/plugins/morris/morris.min.js"></script>
	<script src="assets/js/chart.morris.js"></script>
	<script src="assets/js/api.js"></script>
  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap4.min.js"></script>
  <script>
    // Inject DataTables CSS dynamically (head tag structure is custom on this page)
    (function(){
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap4.min.css';
      document.head && document.head.appendChild(link);
    })();
  </script>
  <script>
    // Notificações (sino do topo)
    (function initNotifications(){
      const badge = document.querySelector('.noti-dropdown .badge-pill');
      const listContainer = document.querySelector('.noti-content');
      const clearBtn = document.querySelector('.clear-noti');

      if (!badge || !listContainer) return;

      async function loadNotificacoes(){
        try{
          const data = await API.getJSON('/api/notificacoes');
          const items = (data && data.items) || [];
          const naoLidas = data && typeof data.naoLidas === 'number' ? data.naoLidas : items.filter(n => !n.lida).length;

          badge.textContent = naoLidas > 0 ? String(naoLidas) : '0';

          if (!items.length){
            listContainer.innerHTML = '<div class="text-center p-2 text-muted">Sem notificações</div>';
            return;
          }

          listContainer.innerHTML = items.map(n => {
            const cls = n.lida ? 'noti-details text-muted' : 'noti-details';
            const titulo = n.titulo || 'Notificação';
            const msg = n.mensagem || '';
            return `
              <div class="media">
                <div class="media-body">
                  <p class="${cls}"><strong>${titulo}</strong><br><small>${msg}</small></p>
                </div>
              </div>`;
          }).join('');
        }catch(e){
          // falha silenciosa para não quebrar o dashboard
        }
      }

      if (clearBtn){
        clearBtn.addEventListener('click', async function(){
          try{
            await API.postJSON('/api/notificacoes/ler-todas', {});
            badge.textContent = '0';
            listContainer.innerHTML = '<div class="text-center p-2 text-muted">Sem notificações</div>';
          }catch(e){/* silencioso */}
        });
      }

      loadNotificacoes();
    })();
  </script>
  <script>
		// Sidebar toggle (mobile)
		const sidebar = document.getElementById('sidebar');
		const menuBtn = document.getElementById('menuBtn');
		if (menuBtn) menuBtn.addEventListener('click', () => sidebar.classList.toggle('open'));
	
		// Verificação de autenticação via JWT com retry/backoff
		async function checkAuth() {
		  const token = localStorage.getItem('token');
		  if (!token) {
			window.location.href = '/';
			return;
		  }
	
		  const banner = document.getElementById('netBanner');
		  const maxTries = 4;
		  let attempt = 0;
	
		  while (attempt < maxTries) {
			try {
			  if (attempt > 0 && banner) banner.style.display = 'block';
			  const res = await fetch('/api/users/me', {
				headers: { Authorization: `Bearer ${token}` }
			  });
	
			  if (res.status === 401 || res.status === 403) {
				// Token inválido/expirado: limpar e voltar ao login
				localStorage.removeItem('token');
				localStorage.removeItem('user');
				window.location.href = '/';
				return;
			  }
	
			  if (!res.ok) {
				// Erros 5xx: tentar novamente
				throw new Error('server_error');
			  }
	
			  const me = await res.json();
			  document.getElementById('userName').textContent = me?.nome || 'usuário';
			  const label = document.getElementById('userLabel');
			  if (label) label.textContent = me?.email || '';
			  if (banner) banner.style.display = 'none';

			  // Controlo de visibilidade de menus conforme o tipo de utilizador
			  try {
				const tipo = me?.tipo;
				// Esconder gestão de utilizadores para quem não é admin
				if (tipo !== 'admin') {
				  const usersLink = document.querySelector('a[href="users.html"]');
				  if (usersLink && usersLink.closest('li')) {
					usersLink.closest('li').style.display = 'none';
				  }
				}
				// Esconder finanças/relatórios para quem não é admin nem contabilista
				if (tipo !== 'admin' && tipo !== 'contabilista') {
				  const finLink = document.querySelector('a[href="financas.html"]');
				  if (finLink && finLink.closest('li.submenu')) {
					finLink.closest('li.submenu').style.display = 'none';
				  }
				  const relFinLink = document.querySelector('a[href="relatorios_financeiros.html"]');
				  if (relFinLink && relFinLink.closest('li')) {
					relFinLink.closest('li').style.display = 'none';
				  }
				}
				// Quando for contabilista, mostrar apenas opções financeiras no dashboard
				if (tipo === 'contabilista') {
				  // Sidebar: esconder Clientes
				  (function(){
					const cliLink = document.querySelector('a[href="clientes_clientes.html"]');
					if (cliLink && cliLink.closest('li.submenu')) {
					  cliLink.closest('li.submenu').style.display = 'none';
					}
				  })();
				  // Sidebar: esconder Empresa (usa links de RH dentro do submenu)
				  (function(){
					const rhLink = document.querySelector('a[href="rh_funcionarios.html"]');
					if (rhLink && rhLink.closest('li.submenu')) {
					  rhLink.closest('li.submenu').style.display = 'none';
					}
				  })();
				  // Sidebar: esconder Fornecedores
				  (function(){
					const fornLink = document.querySelectorAll('a[href="fornecedor.html"]');
					fornLink.forEach(a => {
					  if (a.closest('li.submenu')) a.closest('li.submenu').style.display = 'none';
					});
				  })();
				  // Sidebar: esconder Projectos
				  (function(){
					const projLink = document.querySelector('a[href="projectos.html"]');
					if (projLink && projLink.closest('li')) {
					  projLink.closest('li').style.display = 'none';
					}
				  })();
				  // Sidebar: esconder Configurações (link com ícone de engrenagem)
				  (function(){
					const cogIcon = document.querySelector('a[href="#"] i.fas.fa-cog');
					if (cogIcon && cogIcon.closest('li')) {
					  cogIcon.closest('li').style.display = 'none';
					}
				  })();

				  // Cards de métricas rápidas: esconder Fornecedores e Projectos
				  (function(){
					const cardForn = document.querySelector('.card.board1 a[href="fornecedor.html"]');
					if (cardForn && cardForn.closest('.col-xl-3, .col-lg-3, .col-md-6, .col-sm-6')) {
					  cardForn.closest('.col-xl-3, .col-lg-3, .col-md-6, .col-sm-6').style.display = 'none';
					}
					const cardProj = document.querySelector('.card.board1 a[href="projectos.html"]');
					if (cardProj && cardProj.closest('.col-xl-3, .col-lg-3, .col-md-6, .col-sm-6')) {
					  cardProj.closest('.col-xl-3, .col-lg-3, .col-md-6, .col-sm-6').style.display = 'none';
					}
				  })();

				  // Acesso rápido: esconder atalhos não financeiros (Fornecedores, Projectos, Clientes)
				  (function(){
					const hideQuickByHref = (href) => {
					  const link = document.querySelector(`.quick-link-card[href="${href}"]`) || document.querySelector(`.quick-link-card a[href="${href}"]`);
					  if (link) {
						const col = link.closest('.col-xl-2, .col-lg-3, .col-md-4, .col-sm-6');
						if (col) col.style.display = 'none';
					  }
					};
					hideQuickByHref('fornecedor.html');
					hideQuickByHref('projectos.html');
					hideQuickByHref('clientes_clientes.html');
				  })();
				}
			  } catch (e) {
				console.error('Erro ao ajustar menus por tipo de utilizador', e);
			  }

			  // Avatar no header (dashboard) a partir de /me
			  const avatarUrl = me?.avatarUrl || me?.avatar || '';
			  if (avatarUrl) {
				const headerAvatar = document.querySelector('.user-img img');
				if (headerAvatar) headerAvatar.src = avatarUrl;
				const dropdownAvatar = document.querySelector('.avatar.avatar-sm img');
				if (dropdownAvatar) dropdownAvatar.src = avatarUrl;
			  }

			  return; // sucesso
			} catch (e) {
			  attempt++;
			  if (attempt >= maxTries) {
				// Última tentativa falhou: manter usuário na página e mostrar aviso
				if (banner) banner.textContent = 'Servidor indisponível no momento. Tente novamente mais tarde.';
				return;
			  }
			  // backoff exponencial simples (300ms, 600ms, 1200ms ...)
			  const delay = 300 * Math.pow(2, attempt - 1);
			  await new Promise(r => setTimeout(r, delay));
			}
		  }
		}
		checkAuth();
		document.getElementById('logoutBtn').addEventListener('click', () => {
		  localStorage.removeItem('token');
		  localStorage.removeItem('user');
		  window.location.href = '/';
		});
		// Exemplos de ações
		const btnRefresh = document.getElementById('btnRefresh');
		if (btnRefresh) btnRefresh.addEventListener('click', (e) => {
		  e.preventDefault();
		  // Aqui você pode disparar recarregamento de dados reais
		  location.reload();
		});
	  </script>
</body>

<script>
  // Preenche nome do usuário e carrega métricas do dashboard
  (async function initDashboard(){
    // Nome do usuário
    try{
      const me = await API.getJSON('/api/users/me');
      if (me && me.nome) {
        const nameEls = document.querySelectorAll('.user-name');
        nameEls.forEach(el => el.textContent = me.nome);
      }

      // Avatar no header (dashboard) a partir de /me
      const avatarUrl = me?.avatarUrl || me?.avatar || '';
      if (avatarUrl) {
        const headerAvatar = document.querySelector('.user-img img');
        if (headerAvatar) headerAvatar.src = avatarUrl;
        const dropdownAvatar = document.querySelector('.avatar.avatar-sm img');
        if (dropdownAvatar) dropdownAvatar.src = avatarUrl;
      }
    }catch(e){ /* silencioso */ }

    // Carregar dados para os gráficos (FINANCEIRO e Relatórios)
    async function loadCharts(){
      // Helpers: normalizar números
      const toNum = (v) => {
        const n = Number(String(v||0).replace(/[^0-9\-.,]/g,'').replace(',','.'));
        return isNaN(n) ? 0 : n;
      };

      // 1) Série temporal FINANCEIRO (entradas x saídas por mês)
      let serie = await tryGet('/api/relatorios/financeiro/serie')
               || await tryGet('/api/financas/relatorios/serie')
               || await tryGet('/api/financas/series');
      if(Array.isArray(serie) || Array.isArray(serie?.items)){
        const list = Array.isArray(serie) ? serie : (serie.items || []);
        const dataLine = list.map(it => ({
          mes: it.mes || it.label || it.periodo || '',
          entrada: toNum(it.entrada ?? it.entradas ?? it.receitas ?? 0),
          saida: toNum(it.saida ?? it.saidas ?? it.despesas ?? 0),
        }));
        if(window.Morris){
          try{ document.getElementById('line-chart').innerHTML = ''; }catch{}
          new Morris.Line({
            element: 'line-chart',
            data: dataLine,
            xkey: 'mes',
            ykeys: ['entrada','saida'],
            labels: ['Entradas','Saídas'],
            parseTime: false,
            lineColors: ['#0ab5b3','#08a09e'],
            lineWidth: 3,
            pointSize: 4,
            pointFillColors: ['#0ab5b3','#08a09e'],
            pointStrokeColors: ['#fff','#fff'],
            gridLineColor: '#e0e0e0',
            gridTextColor: '#666',
            resize: true
          });
        }
      } else {
        // Fallback: construir série a partir de fornecedores (saídas por mês)
        const forn = await tryGet('/api/fornecedores');
        const items = Array.isArray(forn) ? forn : (forn?.items || []);
        const map = new Map();
        for(const it of items){
          const mes = it.mes || (it.data_documento || '').toString().slice(0,7) || '';
          const val = toNum(it.valor_documento || it.valor_pago || 0);
          const agg = map.get(mes) || { entrada:0, saida:0 };
          agg.saida += val; // fornecedores normalmente representam despesas
          map.set(mes, agg);
        }
        const dataLine = Array.from(map.entries()).sort((a,b)=>a[0].localeCompare(b[0])).map(([mes, v]) => ({ mes, entrada:v.entrada, saida:v.saida }));
        if(window.Morris){
          try{ document.getElementById('line-chart').innerHTML = ''; }catch{}
          new Morris.Line({ element:'line-chart', data:dataLine, xkey:'mes', ykeys:['entrada','saida'], labels:['Entradas','Saídas'], parseTime:false, lineColors:['#0ab5b3','#08a09e'], lineWidth:3, pointSize:4, pointFillColors:['#0ab5b3','#08a09e'], pointStrokeColors:['#fff','#fff'], gridLineColor:'#e0e0e0', resize:true });
        }
      }

      // 2) Bar Chart - Visão Geral Financeira (Projectos, Investimento, Bancos)
      try {
        // Buscar dados de Projectos - somar coluna valorCotacao
        const projectosRes = await tryGet('/api/projectos') || await tryGet('/api/projetos');
        const projectosItems = Array.isArray(projectosRes) ? projectosRes : (projectosRes?.items || []);
        let valorProjectos = 0;
        for (const proj of projectosItems) {
          // Somar especificamente a coluna valorCotacao
          const val = toNum(proj.valorCotacao || proj.valor_cotacao || 0);
          valorProjectos += val;
        }

        // Buscar dados de Investimento (pode vir de diferentes endpoints)
        const investimentoRes = await tryGet('/api/financas/investimento') || await tryGet('/api/investimento');
        let valorInvestimento = 0;
        if (investimentoRes) {
          if (typeof investimentoRes.total === 'number') {
            valorInvestimento = investimentoRes.total;
          } else if (Array.isArray(investimentoRes) || Array.isArray(investimentoRes?.items)) {
            const items = Array.isArray(investimentoRes) ? investimentoRes : investimentoRes.items;
            for (const inv of items) {
              valorInvestimento += toNum(inv.valor || inv.montante || inv.total || 0);
            }
          }
        }

        // Buscar dados de Bancos
        const bancosRes = await tryGet('/api/financas/bancos');
        const bancosItems = Array.isArray(bancosRes) ? bancosRes : (bancosRes?.items || []);
        let valorBancos = 0;
        for (const banco of bancosItems) {
          valorBancos += toNum(banco.saldo || banco.valor || banco.total || 0);
        }

        // Criar dados para o gráfico de barras
        const dataBar = [
          { categoria: 'Projectos', valor: valorProjectos },
          { categoria: 'Investimento', valor: valorInvestimento },
          { categoria: 'Bancos', valor: valorBancos }
        ];

        if(window.Morris){
          try{ document.getElementById('bar-chart').innerHTML = ''; }catch{}
          new Morris.Bar({ 
            element:'bar-chart', 
            data: dataBar, 
            xkey: 'categoria', 
            ykeys: ['valor'], 
            labels: ['Valor (Kz)'], 
            barColors: ['#0ab5b3', '#08a09e', '#0fd7d4'],
            hideHover: 'auto',
            resize: true,
            gridTextSize: 11,
            barSizeRatio: 0.5
          });
        }
      } catch(e) {
        console.error('Erro ao carregar gráfico de visão geral:', e);
      }
    }

    // Carrega os gráficos
    try{ await loadCharts(); }catch(e){ console.warn('Gráficos: falha ao carregar', e); }

    const fmtKZ = (v) => new Intl.NumberFormat('pt-PT', { style: 'currency', currency: 'AOA', minimumFractionDigits: 2 }).format(Number(v||0));

    async function tryGet(url){ try{ return await API.getJSON(url); }catch{ return null; } }

    // Tenta endpoint consolidado /api/metrics/dashboard
    let metrics = await tryGet('/api/metrics/dashboard');
    if(metrics){
      if(metrics.projetos != null) document.getElementById('projCount').textContent = metrics.projetos;
      if(metrics.fornecedores != null) document.getElementById('fornecedoresCount').textContent = metrics.fornecedores;
      if(metrics.bancos != null) document.getElementById('bancosCount').textContent = metrics.bancos;
      if(metrics.caixa != null) document.getElementById('caixaTotal').textContent = fmtKZ(metrics.caixa);
      return;
    }

    // Fallback: computa métricas por recursos individuais
    // Fornecedores
    (async () => {
      const res = await tryGet('/api/fornecedores/count') || await tryGet('/api/fornecedores');
      const count = (res && typeof res.count === 'number') ? res.count
                    : (res && typeof res.total === 'number') ? res.total
                    : Array.isArray(res) ? res.length
                    : Array.isArray(res?.items) ? res.items.length : 0;
      const el = document.getElementById('fornecedoresCount'); if(el) el.textContent = count;
    })();

    // Bancos
    (async () => {
      const res = await tryGet('/api/financas/bancos/count') || await tryGet('/api/financas/bancos');
      const count = (res && typeof res.count === 'number') ? res.count
                    : (res && typeof res.total === 'number') ? res.total
                    : Array.isArray(res) ? res.length
                    : Array.isArray(res?.items) ? res.items.length : 0;
      document.getElementById('bancosCount').textContent = count;
    })();

    // Projetos (tenta ambas grafias)
    (async () => {
      const res = await tryGet('/api/projectos/count') || await tryGet('/api/projectos') || await tryGet('/api/projetos/count') || await tryGet('/api/projetos');
      console.log('Projectos response:', res);
      const count = (res && typeof res.count === 'number') ? res.count
                    : (res && typeof res.total === 'number') ? res.total
                    : Array.isArray(res) ? res.length
                    : Array.isArray(res?.items) ? res.items.length : 0;
      console.log('Projectos count:', count);
      const el = document.getElementById('projCount');
      if(el) {
        el.textContent = count;
        console.log('Projectos counter updated to:', count);
      } else {
        console.error('Element projCount not found!');
      }
    })();

    // Clientes: contar número total
    (async () => {
      const res = await tryGet('/api/clientes/count') || await tryGet('/api/clientes');
      const count = (res && typeof res.count === 'number') ? res.count
                    : (res && typeof res.total === 'number') ? res.total
                    : Array.isArray(res) ? res.length
                    : Array.isArray(res?.items) ? res.items.length : 0;
      const el = document.getElementById('clientesCount');
      if (el) el.textContent = count;
    })();

    // Dívida Fornecedores (contas a pagar em aberto)
    (async () => {
      const aging = await tryGet('/api/fornecedores/relatorios/contas-pagar/aging');
      if (!aging) return;
      const el = document.getElementById('dividaFornecedoresTotal');
      if (el) el.textContent = fmtKZ(aging.total || 0);
    })();

    // Caixa/Fundo: tenta total direto, senão infere por lista
    (async () => {
      // 1) Preferir soma dos saldos dos bancos
      const bancosTotal = await tryGet('/api/financas/bancos/total');
      if (bancosTotal && typeof bancosTotal.total === 'number'){
        document.getElementById('caixaTotal').textContent = fmtKZ(bancosTotal.total);
        return;
      }
      const bancos = await tryGet('/api/financas/bancos');
      if (Array.isArray(bancos) || Array.isArray(bancos?.items)){
        const list = Array.isArray(bancos) ? bancos : (bancos.items || []);
        const soma = list.reduce((acc, b) => acc + (Number(parseFloat(b?.saldo)) || 0), 0);
        document.getElementById('caixaTotal').textContent = fmtKZ(soma);
        return;
      }
      // 2) Fallback antigo: tentar fundo
      const totalRes = await tryGet('/api/financas/fundo/total');
      if(totalRes && (typeof totalRes.total === 'number' || typeof totalRes.caixa === 'number')){
        const v = totalRes.total ?? totalRes.caixa;
        document.getElementById('caixaTotal').textContent = fmtKZ(v);
        return;
      }
      const res = await tryGet('/api/financas/fundo');
      if(Array.isArray(res)){
        // tenta somar saldo; fallback: somar valores entrada/saida simples
        let total = 0;
        for(const r of res){
          if(typeof r.saldo === 'number'){ total = r.saldo; }
          else if(typeof r.valor === 'number'){
            if(r.tipo && String(r.tipo).toLowerCase().includes('saida')) total -= r.valor; else total += r.valor;
          }
        }
        document.getElementById('caixaTotal').textContent = fmtKZ(total);
      } else if (res && Array.isArray(res?.items)){
        let total = 0;
        for(const r of res.items){
          if(typeof r.saldo === 'number'){ total = r.saldo; }
          else if(typeof r.valor === 'number'){
            if(r.tipo && String(r.tipo).toLowerCase().includes('saida')) total -= r.valor; else total += r.valor;
          }
        }
        document.getElementById('caixaTotal').textContent = fmtKZ(total);
      }
    })();

    // Mapa Fornecedores: carregar e renderizar primeiras linhas
    (async () => {
      try{
        const res = await tryGet('/api/fornecedores?limit=10');
        const items = Array.isArray(res) ? res : (res?.items || []);
        const tbody = document.getElementById('tbodyMapaFornecedores');
        if (!tbody) return;
        const esc = (v) => (v==null?'' : String(v));
        tbody.innerHTML = items.slice(0,10).map(it => `
          <tr>
            <td>${esc(it.num_ordem)}</td>
            <td>${esc(it.nif)}</td>
            <td>${esc(it.nome)}</td>
            <td>${esc(it.pago_via)}</td>
            <td>${esc(it.num_factura)}</td>
            <td>${esc(it.custo_aceite)}</td>
            <td>${esc(it.data_documento)}</td>
            <td>${esc(it.mes)}</td>
            <td>${esc(it.valor_documento)}</td>
            <td>${esc(it.valor_iva)}</td>
            <td>${esc(it.valor_retencao)}</td>
            <td>${esc(it.iva_dedutivel)}</td>
            <td>${esc(it.iva_suportado)}</td>
            <td>${esc(it.iva_dedutivel2)}</td>
            <td>${esc(it.valor_pago)}</td>
            <td>${esc(it.divida)}</td>
            <td>${esc(it.situacao)}</td>
            <td>${esc(it.rfont)}</td>
            <td>${esc(it.tipologia)}</td>
            <td>${esc(it.id_projecto)}</td>
            <td>${esc(it.obs)}</td>
            <td>${esc(it.data_pagamento)}</td>
          </tr>
        `).join('');
        try{
          if ($.fn.DataTable && $.fn.DataTable.isDataTable('#tblMapaFornecedores')){
            $('#tblMapaFornecedores').DataTable().destroy();
          }
          $('#tblMapaFornecedores').DataTable({
            pageLength: 5,
            lengthChange: false,
            ordering: true,
            language: { url: 'https://cdn.datatables.net/plug-ins/1.13.8/i18n/pt-PT.json' }
          });
        }catch(e){ console.warn('DataTable init (dashboard) falhou:', e); }
      }catch(e){ console.error('Erro a carregar mapa de fornecedores', e); }
    })();

    // Botão "Ver Todos" abre fornecedores.html
    document.addEventListener('click', (e) => {
      const btn = e.target.closest && e.target.closest('.veiwbutton');
      if(btn){ window.location.href = 'fornecedores.html'; }
    });
  })();

  // Logout handler (caso não esteja já no script global)
  document.addEventListener('click', (e) => {
    if(e.target && e.target.id === 'logoutBtn'){
      // Guardar utilizador no localStorage para outras páginas
      localStorage.setItem('user', JSON.stringify(me));
      window.location.href = '/';
    }
  });
</script>
</html>